@using System.Runtime.CompilerServices
@using Navigation
@inject NavManager NavManager
@inject IStringLocalizer<NavMenu> T
@inject Blazored.LocalStorage.ISyncLocalStorageService LocalStorageService

<MudNavMenu>
    <MudSpacer />

    @foreach (var navGroup in NavManager.Groups)
    {
        <MudNavGroup Title="@navGroup.Name" Expanded="navGroup.Expanded" ExpandedChanged="(v) => Save(v, navGroup)">
            @foreach (var navItem in navGroup.Items)
            {
                @if (navItem.RequireAuthorization)
                {
                    <AuthorizeView Roles="@navItem.Roles">
                        <MudNavLink Icon="@navItem.Icon" Href="@navItem.Href">@navItem.Name</MudNavLink>
                    </AuthorizeView>
                }
                else
                {
                    <MudNavLink Icon="@navItem.Icon" Href="@navItem.Href">@navItem.Name</MudNavLink>
                }
            }
        </MudNavGroup>
    }
</MudNavMenu>

@code {
    bool general;
    bool showroom;
    bool projects;
    bool finance;
    bool admin;

    protected override void OnInitialized()
    {
        foreach(var navGroup in NavManager.Groups) 
        {
            navGroup.Expanded = LocalStorageService.GetItem<bool>($"navmenu.{navGroup.Id.ToLower()}");
        }
    }

    bool Save(bool newValue, NavGroup navGroup)
    {
        LocalStorageService.SetItem($"navmenu.{navGroup.Id}", newValue);
        navGroup.Expanded = newValue;
        return newValue;
    }
}