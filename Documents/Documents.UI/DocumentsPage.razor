@page "/documents"
@inject IDocumentsClient DocumentsClient
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager

<PageTitle>Documents</PageTitle>

<MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true" Class="mt-4 mb-8">Documents</MudText>

@* <MudButton Variant="Variant.Filled" OnClick="NewDocument" Class="mb-2">New document</MudButton> *@

<MudTable T="DocumentDto" @ref="table" ServerData="ServerReload" Hover="true" Elevation="1" Breakpoint="Breakpoint.Sm"
    Loading="@loading" LoadingProgressColor="Color.Info">
    
     <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Date</MudTh>
        <MudTh>Content Type</MudTh>
        <MudTh></MudTh>
     </HeaderContent>
    <RowTemplate Context="document">
        <MudTd DataLabel="Name">@($"{document.Title}.{document.Extension}")</MudTd>
        <MudTd DataLabel="Date">@document.Created.ToString("g")</MudTd>
        <MudTd DataLabel="Content Type">@document.ContentType</MudTd>
        <MudTh>
            <MudIconButton Icon="@Icons.Filled.FileDownload" Link="@document.Url" Target="_blank" @onclick:stopPropagation />
            @* <MudIconButton Icon="@Icons.Material.Filled.Edit" OnClick="async () => await OnEditProjectClicked(project)" /> *@
            @* <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="async () => await DeleteOption(option)" /> *@
        </MudTh>
    </RowTemplate>
    <LoadingContent>
        <MudText>Loading...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

@code
{
    MudTable<DocumentDto> table = null!;
    bool loading = false;

    private async Task<TableData<DocumentDto>> ServerReload(TableState state)
    {
        loading = true;

        try
        {
            var result = await DocumentsClient.GetDocumentsAsync(state.Page, state.PageSize);

            return new TableData<DocumentDto>() { TotalItems = result.TotalItems, Items = result.Items };
        }
        finally
        {
            loading = false;
        }
    }

    /*
    public async Task NewDocument()
    {
        var dialogRef = DialogService.Show<NewDocumentDialog>("New document");

        var result = await dialogRef.Result;

        if (result.Cancelled) return;

        await table.ReloadServerData();
    }
    */
}